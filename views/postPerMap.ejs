<%- include('./includes/header.ejs') %>

<!-- Banner -->
<div class="container-fluid px-0 mb-4">
  <div class="position-relative">
    <img src="<%= posts.length > 0 ? posts[0].map_img : '/images/default-map.jpg' %>" 
          alt="<%= posts.length > 0 ? posts[0].map_name : '' %>"
          class="w-100" style="max-height: 400px; object-fit: cover;">

    <div class="position-absolute top-50 start-50 translate-middle text-center text-white">
      <% if(posts.length > 0) { %>
        <h1 class="display-5 fw-bold mb-2">
          <%= posts[0].agent_name %> - <%= posts[0].map_name %>
        </h1>
        <p class="lead">Tous les guides et line-ups pour cet agent sur cette map</p>
      <% } else { %>
        <h1 class="display-5 fw-bold mb-2">Aucun guide trouvé</h1>
        <p class="lead">Reviens plus tard pour voir des nouveaux contenus</p>
      <% } %>
    </div>
  </div>
</div>

<!-- Liste des posts -->
<div class="container">
  <h2 class="mb-4 text-center">Guides disponibles</h2>

  <% if(posts.length === 0) { %>
    <div class="alert alert-warning text-center">
      Aucun guide n'a encore été ajouté pour cet agent et cette map.
    </div>
  <% } else { %>
    <div class="row g-4">
      <% posts.forEach(post => { %>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm position-relative">
            <!-- Image du post -->
            <div class="ratio ratio-16x9">
              <img src="<%= post.img %>" class="card-img-top object-fit-cover" alt="<%= post.title %>">
            </div>

            <div class="card-body d-flex flex-column">
              <!-- Titre -->
              <h5 class="card-title text-truncate"><%= post.title %></h5>
              
              <!-- Description courte -->
              <p class="card-text text-muted text-truncate">
                <%= post.description || post.content?.substring(0, 80) + '...' %>
              </p>

              <!-- Type et date -->
              <div class="d-flex justify-content-between mb-2">
                <span class="badge bg-danger"><%= post.type %></span>
                <small class="text-muted">
                  <%= new Date(post.date).toLocaleDateString('fr-FR') %>
                </small>
              </div>

              <!-- Lien sur toute la carte -->
              <a href="/posts/<%= post.id %>" class="stretched-link"></a>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('./includes/footer.ejs') %>
